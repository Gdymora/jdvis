<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>components/adminPanel/adminPanelInit.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-ModernLib.html">ModernLib</a></li><li><a href="module-components_accordion.html">components/accordion</a></li><li><a href="module-components_adminPanel.html">components/adminPanel</a></li><li></li><li><a href="module-components_adminPanel_components.html">components/adminPanel/components</a></li><li><a href="module-components_adminPanel_init.html">components/adminPanel/init</a><ul class='methods'><li data-type='method'><a href="module-components_adminPanel_init.html#.initializeAdminPanel">initializeAdminPanel</a></li><li data-type='method'><a href="module-components_adminPanel_init.html#~checkPermission">checkPermission</a></li></ul></li><li><a href="module-components_adminPanel_services.html">components/adminPanel/services</a></li><li><a href="module-components_adminPanel_services_tableStructure.html">components/adminPanel/services/tableStructure</a><ul class='methods'><li data-type='method'><a href="module-components_adminPanel_services_tableStructure.html#~create">create</a></li><li data-type='method'><a href="module-components_adminPanel_services_tableStructure.html#~delete">delete</a></li><li data-type='method'><a href="module-components_adminPanel_services_tableStructure.html#~getAll">getAll</a></li><li data-type='method'><a href="module-components_adminPanel_services_tableStructure.html#~getById">getById</a></li><li data-type='method'><a href="module-components_adminPanel_services_tableStructure.html#~update">update</a></li></ul></li><li><a href="module-components_adminPanel_services_user.html">components/adminPanel/services/user</a><ul class='methods'><li data-type='method'><a href="module-components_adminPanel_services_user.html#~create">create</a></li><li data-type='method'><a href="module-components_adminPanel_services_user.html#~delete">delete</a></li><li data-type='method'><a href="module-components_adminPanel_services_user.html#~getAll">getAll</a></li><li data-type='method'><a href="module-components_adminPanel_services_user.html#~getById">getById</a></li><li data-type='method'><a href="module-components_adminPanel_services_user.html#~getCurrentUser">getCurrentUser</a></li><li data-type='method'><a href="module-components_adminPanel_services_user.html#~hasPermission">hasPermission</a></li><li data-type='method'><a href="module-components_adminPanel_services_user.html#~hasRole">hasRole</a></li><li data-type='method'><a href="module-components_adminPanel_services_user.html#~update">update</a></li></ul></li><li><a href="module-components_adminPanelAuth.html">components/adminPanelAuth</a><ul class='methods'><li data-type='method'><a href="module-components_adminPanelAuth.html#.showLoginForm">showLoginForm</a></li></ul></li><li><a href="module-components_auth.html">components/auth</a><ul class='methods'><li data-type='method'><a href="module-components_auth.html#~getMe">getMe</a></li><li data-type='method'><a href="module-components_auth.html#~login">login</a></li><li data-type='method'><a href="module-components_auth.html#~logout">logout</a></li><li data-type='method'><a href="module-components_auth.html#~refreshToken">refreshToken</a></li><li data-type='method'><a href="module-components_auth.html#~setToken">setToken</a></li></ul></li><li><a href="module-components_cardGenerator.html">components/cardGenerator</a></li><li><a href="module-components_carousel.html">components/carousel</a></li><li><a href="module-components_carouselBlog.html">components/carouselBlog</a></li><li><a href="module-components_dropdown.html">components/dropdown</a></li><li><a href="module-components_loadPosts.html">components/loadPosts</a></li><li><a href="module-components_loadPostsLocal.html">components/loadPostsLocal</a></li><li><a href="module-components_modal.html">components/modal</a></li><li><a href="module-components_navigation.html">components/navigation</a></li><li><a href="module-components_notification.html">components/notification</a></li><li><a href="module-components_pagination.html">components/pagination</a></li><li><a href="module-components_permission.html">components/permission</a><ul class='methods'><li data-type='method'><a href="module-components_permission.html#~create">create</a></li><li data-type='method'><a href="module-components_permission.html#~delete">delete</a></li><li data-type='method'><a href="module-components_permission.html#~getAll">getAll</a></li><li data-type='method'><a href="module-components_permission.html#~getAllPermissions">getAllPermissions</a></li><li data-type='method'><a href="module-components_permission.html#~getById">getById</a></li><li data-type='method'><a href="module-components_permission.html#~update">update</a></li></ul></li><li><a href="module-components_postGenerator.html">components/postGenerator</a></li><li><a href="module-components_projectComponent.html">components/projectComponent</a><ul class='methods'><li data-type='method'><a href="module-components_projectComponent.html#~createProject">createProject</a></li><li data-type='method'><a href="module-components_projectComponent.html#~deleteProject">deleteProject</a></li><li data-type='method'><a href="module-components_projectComponent.html#~getProjects">getProjects</a></li><li data-type='method'><a href="module-components_projectComponent.html#~updateProject">updateProject</a></li></ul></li><li><a href="module-components_projectRoleComponent.html">components/projectRoleComponent</a><ul class='methods'><li data-type='method'><a href="module-components_projectRoleComponent.html#~assignMultiplePermissions">assignMultiplePermissions</a></li><li data-type='method'><a href="module-components_projectRoleComponent.html#~assignPermission">assignPermission</a></li><li data-type='method'><a href="module-components_projectRoleComponent.html#~create">create</a></li><li data-type='method'><a href="module-components_projectRoleComponent.html#~delete">delete</a></li><li data-type='method'><a href="module-components_projectRoleComponent.html#~getAll">getAll</a></li><li data-type='method'><a href="module-components_projectRoleComponent.html#~getById">getById</a></li><li data-type='method'><a href="module-components_projectRoleComponent.html#~removePermission">removePermission</a></li><li data-type='method'><a href="module-components_projectRoleComponent.html#~update">update</a></li></ul></li><li><a href="module-components_tab.html">components/tab</a></li><li><a href="module-components_tableData.html">components/tableData</a><ul class='methods'><li data-type='method'><a href="module-components_tableData.html#~create">create</a></li><li data-type='method'><a href="module-components_tableData.html#~createExcel">createExcel</a></li><li data-type='method'><a href="module-components_tableData.html#~delete">delete</a></li><li data-type='method'><a href="module-components_tableData.html#~getAll">getAll</a></li><li data-type='method'><a href="module-components_tableData.html#~getById">getById</a></li><li data-type='method'><a href="module-components_tableData.html#~update">update</a></li></ul></li><li><a href="module-core.html">core</a><ul class='methods'><li data-type='method'><a href="module-core.html#~$">$</a></li></ul></li><li><a href="module-domManipulation.html">domManipulation</a></li><li><a href="module-modules_actions.html">modules/actions</a></li><li><a href="module-modules_attributes.html">modules/attributes</a></li><li><a href="module-modules_classes.html">modules/classes</a></li><li><a href="module-modules_display.html">modules/display</a></li><li><a href="module-modules_effects.html">modules/effects</a></li><li><a href="module-modules_handlers.html">modules/handlers</a></li><li><a href="module-modules_jqueryLikeMethods.html">modules/jqueryLikeMethods</a></li><li><a href="module-modules_objectUtils.html">modules/objectUtils</a></li><li><a href="module-modules_url.html">modules/url</a></li><li><a href="module-services_request.html">services/request</a></li></ul><h3>Events</h3><ul><li><a href="context.html#event:accessDenied">accessDenied</a></li><li><a href="context.html#event:adminPanelInitialized">adminPanelInitialized</a></li><li><a href="context.html#event:afterContentLoad">afterContentLoad</a></li><li><a href="context.html#event:beforeContentLoad">beforeContentLoad</a></li><li><a href="context.html#event:dashboardLoaded">dashboardLoaded</a></li><li><a href="context.html#event:logoutError">logoutError</a></li><li><a href="context.html#event:logoutSuccess">logoutSuccess</a></li><li><a href="context.html#event:pageNotFound">pageNotFound</a></li><li><a href="context.html#event:settingsLoaded">settingsLoaded</a></li><li><a href="context.html#event:usersLoaded">usersLoaded</a></li></ul>
    
</nav>

<div id="main">
    
    <h1 class="page-title">components/adminPanel/adminPanelInit.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @file adminPanelInit.js
 * @description Initialization functions for the admin panel
 * @module components/adminPanel/init
 */
import { createTabs, createModal } from "./util/helperFunctions";
/**
 * Checks if the current user has a specific permission
 * @param {Object} services - The services object containing the userService
 * @param {string} permission - The permission to check
 * @returns {Promise&lt;boolean>} A promise that resolves to true if the user has the permission, false otherwise
 */
async function checkPermission(services, permission, projectId) {
  try {
    if (!services || !services.userService || typeof services.userService.hasPermission !== "function") {
      console.error("User service or hasPermission method is not available");
      return false;
    }
    return await services.userService.hasPermission(permission, projectId);
  } catch (error) {
    console.error("Error checking permission:", error);
    return false;
  }
}

/**
 * Initializes the admin panel
 * @param {Object} context - The ModernLib context
 * @param {Object} user - The authenticated user object
 * @param {Object} options - Configuration options
 * @param {string} options.projectId - The ID of the current project
 * @param {Function} options.onMenuItemClick - Callback function for menu item clicks
 * @param {Array} [options.menuItems=[]] - Array of menu items
 * @param {Object} options.services - The initialized services
 * @param {Object} options.components - The initialized components
 * @fires context#adminPanelInitialized
 * @fires context#beforeMenuItemClick
 * @fires context#beforeContentLoad
 * @fires context#afterContentLoad
 * @fires context#dashboardLoaded
 * @fires context#usersLoaded
 * @fires context#rolesLoaded
 * @fires context#permissionsLoaded
 * @fires context#tablesLoaded
 * @fires context#postsLoaded
 * @fires context#accessDenied
 * @fires context#pageNotFound
 * @fires context#beforeLogout
 * @fires context#logoutSuccess
 * @fires context#logoutError
 * @fires context#adminPanelReady
 * @example
 * initializeAdminPanel($('#adminPanel'), { name: 'John Doe' }, {
 *   projectId: '123',
 *   onMenuItemClick: (menuId) => console.log(menuId),
 *   services: services,
 *   components: components
 * });
 */
export function initializeAdminPanel(context, user, options) {
  const { projectId, onMenuItemClick, menuItems = [], services, components, customComponents = {}, additionalComponents = {} } = options;

  if (!context || context.length === 0) {
    console.warn("Context is empty or undefined, initializing with document body");
    context = $(document.body);
  }

  const createMenuItem = (item) => `
    &lt;a href="#" data-menu-id="${item.id}" class="block py-2 px-4 text-sm text-gray-700 hover:bg-gray-100">
      ${item.label}
    &lt;/a>
  `;

  const createSidebar = () => `
    &lt;div class="w-64 bg-white shadow-md">
      &lt;div class="p-4 bg-blue-600 text-white font-bold">
        Admin Panel
      &lt;/div>
      &lt;div class="p-4">
        &lt;p>Welcome, ${user.name}&lt;/p>
        &lt;button id="logoutBtn" class="mt-2 px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600">Logout&lt;/button>
      &lt;/div>
      &lt;nav class="mt-4">
        ${menuItems.map(createMenuItem).join("")}
      &lt;/nav>
    &lt;/div>
  `;

  const createMainContent = () => `
    &lt;div class="flex-1 p-8">
      &lt;h1 class="text-2xl font-bold mb-4">Welcome to Admin Panel&lt;/h1>
      &lt;div id="contentArea">
        &lt;!-- Dynamic content will be loaded here -->
      &lt;/div>
    &lt;/div>
  `;

  const adminPanelHTML = `
    &lt;div class="flex h-screen bg-gray-100">
      ${createSidebar()}
      ${createMainContent()}
    &lt;/div>
  `;

  context.html(adminPanelHTML); 

  /**
   * Fires when the admin panel is initialized
   * @event context#adminPanelInitialized
   * @type {object}
   * @property {object} user - The authenticated user object
   * @property {string} projectId - The ID of the current project
   */
  context.trigger("adminPanelInitialized", { user, projectId });

  context.find("nav a").on("click", async function (e) {
    e.preventDefault();
    const menuId = this.getAttribute("data-menu-id");
    onMenuItemClick(menuId);

    // Update active menu item
    context.find("nav a").removeClass("bg-blue-100");
    context.find(this).addClass("bg-blue-100");

    // Load content based on menu item
    const contentArea = $(document.querySelector("#contentArea"));

    if (!contentArea || contentArea.length === 0) {
      console.error("Content area not found");
      return;
    }

    /**
     * Fires before content is loaded
     * @event context#beforeContentLoad
     * @type {object}
     * @property {string} menuId - The ID of the selected menu item
     * @property {Object} contentArea - The content area element
     */
    context.trigger("beforeContentLoad", { menuId, contentArea });
    const loadOptions = { page: 1, itemsPerPage: options.itemsPerPage };

    // Перевіряємо, чи є користувацький компонент для цього пункту меню
    if (customComponents[menuId]) {
      if (await checkPermission(services, `view_${menuId}`, projectId)) {
        // Передаємо допоміжні функції в користувацький компонент
        customComponents[menuId].load(contentArea, projectId, services[`${menuId}Service`], loadOptions);
        context.trigger(`${menuId}Loaded`);
      } else {
        contentArea.html(`&lt;h2 class="text-xl mb-4">Access Denied&lt;/h2>&lt;p>You do not have permission to view ${menuId}.&lt;/p>`);
        context.trigger("accessDenied", { section: menuId });
      }
    } else {
      switch (menuId) {
        case "dashboard":
          console.log("Dashboard case");
          contentArea.html('&lt;h2 class="text-xl mb-4">Dashboard&lt;/h2>&lt;p>Welcome to your dashboard.&lt;/p>');
          /**
           * Fires when the dashboard is loaded
           * @event context#dashboardLoaded
           */
          context.trigger("dashboardLoaded");
          break;
        case "users":
          console.log("Users case");
          if (await checkPermission(services, "viewAny_project_user", projectId)) {
            try {
              components.userManagement.load(contentArea, projectId, services.userService, services.roleService, loadOptions);
            } catch (error) {
              console.error("Error loading table management component:", error);
              contentArea.html('&lt;h2 class="text-xl mb-4">Error&lt;/h2>&lt;p>An error occurred while loading the tables component.&lt;/p>');
            }
            /**
             * Fires when the users section is loaded
             * @event context#usersLoaded
             */
            components.userManagement.trigger("usersLoaded");
          } else {
            contentArea.html('&lt;h2 class="text-xl mb-4">Access Denied&lt;/h2>&lt;p>You do not have permission to view users.&lt;/p>');
            /**
             * Fires when access is denied to a section
             * @event context#accessDenied
             * @type {object}
             * @property {string} section - The section to which access was denied
             */
            context.trigger("accessDenied", { section: "users" });
          }
          break;
        case "roles":
          console.log("Roles case");
          if (await checkPermission(services, "view_project_roles", projectId)) {
            try {
              components.roleManagement.load(contentArea, projectId, services.roleService, services.permissionService, loadOptions);
            } catch (error) {
              console.error("Error loading table management component:", error);
              contentArea.html('&lt;h2 class="text-xl mb-4">Error&lt;/h2>&lt;p>An error occurred while loading the tables component.&lt;/p>');
            }
          } else {
            contentArea.html('&lt;h2 class="text-xl mb-4">Access Denied&lt;/h2>&lt;p>You do not have permission to view roles.&lt;/p>');
          }
          break;
        case "permissions":
          console.log("Permissions case");
          if (await checkPermission(services, "viewAny_project_permission", projectId)) {
            try {
              components.permissionManagement.load(contentArea, projectId, services.permissionService, services.roleService, loadOptions);
            } catch (error) {
              console.error("Error loading table management component:", error);
              contentArea.html('&lt;h2 class="text-xl mb-4">Error&lt;/h2>&lt;p>An error occurred while loading the tables component.&lt;/p>');
            }
          } else {
            contentArea.html('&lt;h2 class="text-xl mb-4">Access Denied&lt;/h2>&lt;p>You do not have permission to view permissions.&lt;/p>');
          }
          break;
        case "tables":
          console.log("Tables case");
          if (await checkPermission(services, "viewAny_project_table_structure", projectId)) {
            try {
              components.tableManagement.load(contentArea, projectId, services.tableStructureService, services.tableDataService, loadOptions);
            } catch (error) {
              console.error("Error loading table management component:", error);
              contentArea.html('&lt;h2 class="text-xl mb-4">Error&lt;/h2>&lt;p>An error occurred while loading the tables component.&lt;/p>');
            }
          } else {
            contentArea.html('&lt;h2 class="text-xl mb-4">Access Denied&lt;/h2>&lt;p>You do not have permission to view tables.&lt;/p>');
          }
          break;
        case "posts":
          console.log("Posts case");
          if (await checkPermission(services, "viewAny_project_table_data", projectId)) {
            try {
              components.postManagement.load(contentArea, projectId, services.tableDataService, loadOptions);
            } catch (error) {
              console.error("Error loading table management component:", error);
              contentArea.html('&lt;h2 class="text-xl mb-4">Error&lt;/h2>&lt;p>An error occurred while loading the tables component.&lt;/p>');
            }
          } else {
            contentArea.html('&lt;h2 class="text-xl mb-4">Access Denied&lt;/h2>&lt;p>You do not have permission to view posts.&lt;/p>');
          }
          break;
        case "settings":
          /**
           * Fires when the dashboard is loaded
           * @event context#settingsLoaded
           */
          context.trigger("settingsLoaded");
          break;
        default:
          console.log("Default case");
          contentArea.html('&lt;h2 class="text-xl mb-4">Not Found&lt;/h2>&lt;p>The requested page does not exist.&lt;/p>');
          /**
           * Fires when a non-existent page is requested
           * @event context#pageNotFound
           * @type {object}
           * @property {string} menuId - The ID of the non-existent menu item
           */
          context.trigger("pageNotFound", { menuId });
      }
    }
    // console.log("Exiting switch statement");
    /**
     * Fires after content is loaded
     * @event context#afterContentLoad
     * @type {object}
     * @property {string} menuId - The ID of the selected menu item
     * @property {Object} contentArea - The content area element
     */
    context.trigger("afterContentLoad", { menuId, contentArea });
  });

  $(document.querySelector("#logoutBtn")).on("click", function (e) {
    e.preventDefault();
    services.authService
      .logout(projectId)
      .then(() => {
        /**
         * Fires when logout is successful
         * @event context#logoutSuccess
         */
        context.trigger("logoutSuccess");
        window.location.reload();
      })
      .catch((error) => {
        console.error("Logout failed:", error);
        /**
         * Fires when logout fails
         * @event context#logoutError
         * @type {object}
         * @property {Error} error - The error object
         */
        context.trigger("logoutError", { error });
        window.location.reload();
      });
  });
}
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 4.0.3</a> on Wed Oct 02 2024 10:44:18 GMT+0200 (GMT+02:00) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
